var W=Object.create;var w=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var F=Object.getPrototypeOf,G=Object.prototype.hasOwnProperty;var L=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),H=(t,e)=>{for(var r in e)w(t,r,{get:e[r],enumerable:!0})},b=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of B(e))!G.call(t,o)&&o!==r&&w(t,o,{get:()=>e[o],enumerable:!(n=k(e,o))||n.enumerable});return t};var K=(t,e,r)=>(r=t!=null?W(F(t)):{},b(e||!t||!t.__esModule?w(r,"default",{value:t,enumerable:!0}):r,t)),M=t=>b(w({},"__esModule",{value:!0}),t);var j=L(d=>{var E={__version__:!0,__id__:!0,rowid:!0};d.inbuiltProps=E;d.clean=function(e){return E[e]||e.startsWith('"___')?e:JSON.stringify(e.startsWith("___")?e:"___"+e.replace(/\./g,"___")+"__")};d.unflatten=function(t){let e={};for(let r in t)if(r.slice(0,3)==="___"){let n=r.slice(3,-2);if(n.indexOf("___")>-1){let o=n.split("___"),s=e;for(let c=0;c<o.length-1;c++)s=s[o[c]]={};s[o[o.length-1]]=t[r]}else e[n]=t[r]}else e[r]=t[r];return e};function X(t){if(t.indexOf("___")>-1)throw"Invalid key"}d.flatten=function t(e,r=""){let n={};for(let o in e)X(o),e[o]&&typeof e[o]=="object"&&!Array.isArray(e[o])&&!e[o].__isUpdateValue__?n[r+o]=t(e[o],r+o+"."):n[r+o]=e[o];return e.hasOwnProperty("__version__")||(n.__version__=Date.now()),n}});var gt={};H(gt,{addDoc:()=>nt,arrayRemove:()=>wt,arrayUnion:()=>xt,collection:()=>q,deleteDoc:()=>et,deleteField:()=>mt,doc:()=>z,documentId:()=>m,endBefore:()=>lt,getAirstore:()=>Q,getCountFromServer:()=>ct,getDoc:()=>A,getDocs:()=>st,increment:()=>_t,limit:()=>pt,limitToLast:()=>ft,onSnapshot:()=>it,orderBy:()=>ut,query:()=>R,queryEqual:()=>tt,ref:()=>U,refEqual:()=>N,runTransaction:()=>dt,setDoc:()=>rt,startAfter:()=>at,updateDoc:()=>ot,where:()=>T,writeBatch:()=>ht});module.exports=M(gt);var f=K(j());var g,Y=new Uint8Array(16);function C(){if(!g&&(g=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!g))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return g(Y)}var i=[];for(let t=0;t<256;++t)i.push((t+256).toString(16).slice(1));function P(t,e=0){return i[t[e+0]]+i[t[e+1]]+i[t[e+2]]+i[t[e+3]]+"-"+i[t[e+4]]+i[t[e+5]]+"-"+i[t[e+6]]+i[t[e+7]]+"-"+i[t[e+8]]+i[t[e+9]]+"-"+i[t[e+10]]+i[t[e+11]]+i[t[e+12]]+i[t[e+13]]+i[t[e+14]]+i[t[e+15]]}var Z=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),S={randomUUID:Z};function $(t,e,r){if(S.randomUUID&&!e&&!t)return S.randomUUID();t=t||{};let n=t.random||(t.rng||C)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(let o=0;o<16;++o)e[r+o]=n[o];return e}return P(n)}var y=$;function Q(t,e){return{async api(r,n="GET",o=""){return await(await fetch(t+r,{body:n!=="GET"?o:void 0,headers:{authorization:e.auth&&e.auth.currentUser?await e.auth.currentUser.getIdToken(!0).catch(function(s){console.error(s)}):null}})).json()}}}function U(t,e){if(/___/.test(t)||!/^[a-z][a-z_0-9]+(\/[a-z][a-z_0-9]+\/[a-z][a-z_0-9]+)+/.test(t))throw new Error("Invalid path "+t);return{path:t,id:t.split("/").pop(),airstore:e,_parent:null,get parent(){return this._parent||(this._parent=U(t.slice(0,-this.id.length-1),e))}}}function q(...t){let e=typeof t[0]=="function"?t.shift():null,r=t.join("/");if(r.split("/").length%2!==1)throw new Error("Wrong number of segments in collection");return U(r,e)}function z(...t){let e;typeof t[0]=="object"&&(t[0].api?e=t.shift():(e=t[0].airstore,t[0]=t[0].path,t.length===1&&t.push(y())));let r=t.join("/")??y();if(r.split("/").length%2!==0)throw new Error("Wrong number of segments in doc");return U(r,e)}function N(t,e){return JSON.stringify(t)===JSON.stringify(e)}function tt(t,e){return N(t,e)}async function I(t,e,r,n){try{return await t.airstore.api(e,r,n)}finally{let o=p[t.parent.path];o&&o.forEach(s=>s())}}async function et(t){return await I(t,"/delete/"+encodeURIComponent(t.parent.path)+"/"+encodeURIComponent(t.id),"POST")}async function rt(t,e,r){if(!r.merge)throw new Error("merge must be true");return await I(t,"/set/"+encodeURIComponent(t.parent.path)+"/"+encodeURIComponent(t.id)+"?create&update","POST",e)}async function nt(t){return await I(z(t),"/set/"+encodeURIComponent(t.parent.path)+"/"+encodeURIComponent(t.id)+"?create","POST")}async function ot(t,e){return await I(t,"/set/"+encodeURIComponent(t.parent.path)+"/"+encodeURIComponent(t.id)+"?update","POST",e)}function R(t,...e){let r={};for(let n of e)if(n.order&&(r.order?(r.order.props.push(...n.order.props),r.order.desc.push(...n.order.desc)):r.order={props:[...n.order.props],desc:[...n.order.desc]}),n.limit!==void 0){if(r.limit!==void 0)throw new Error("Duplicate limit clause");r.limit=n.limit}for(let n of e)if(n.cursor)for(let o=0;o<n.cursor.length;o++)e.push({filter:{prop:typeof n.cursor[o]=="object"?m():n.order.props[o],op:n.op,val:n.cursor[o]}});for(let n of e)n.filter&&(r.filter&&!r.filter.next?r.filter.next=n.filter:!r.filter||!n.next?r.filter={...n.filter,next:r.filter}:r.filter={val:r.filter,next:n.filter});return{query:r,converter:void 0,withConverter(n){return{...this,converter:n}},ref:t}}var h=class{constructor(e,r,n,o){this.ref=e,this._conv=r,this._data=n,this.columns=o}data(e){if(!e&&this._conv)return this._conv.fromFirestore(this,{});if(!this._data)return;let r={};for(let n of this.columns)f.inbuiltProps[this.columns[n]]||(r[this.columns[n]]=this._data[n]);return f.unflatten(r)}exists(){return!!this._data}get(e){return this._data[this.columns.indexOf(f.clean(e))]}version(){return this._data?this.get("__version__"):!1}id(){return this.get(m())}},D=class{constructor(e){this._docs=null,this._data=e}get docs(){return this._docs||(this._docs=this._data.map(e=>e.data()))}},p={};function J(t,e,r,n){let o=r.rows.map(s=>typeof s=="string"?e.docs.find(c=>c.id()):new h(t.ref,t.converter,s,r.columns));return n?o[0]||new h(t.ref):new D(o)}function it(t,e){let r,n="path"in t;n&&(t=R(t.ref.parent,T(m(),"==",t.id)).withConverter(t.converter));let o="/poll/"+encodeURIComponent(t.ref.path)+"?query="+encodeURIComponent(JSON.stringify(t.query)),s,c,a=0,_=async function(){a>0&&(a=2),clearTimeout(c);try{a=1;let u=await t.ref.airstore.api(o+"&cursor="+encodeURIComponent(r));a--,u.cursor!==!0&&(r=u.cursor);let x;if(u.rows&&(s=x=J(t,s,u,n)),c!==null&&(c=setTimeout(()=>{a=0,_()},a===0?x?5e3:1e4:1e3),x))return e.next(x)}catch(u){c!==null&&(e.error?e.error(u):console.error(u))}};return p[t.ref.path]||(p[t.ref.path]=[]),p[t.ref.path].push(_),_(),()=>{clearTimeout(c),c=null;let u=p[t.ref.path].indexOf(_);u>-1&&p[t.ref.path].splice(u,1)}}async function V(t,e){return J(t,null,await t.ref.airstore.api("/collection/"+encodeURIComponent(t.ref.path)+"?query="+encodeURIComponent(JSON.stringify(t.query))),e)}async function st(t){return t.ref||(t=R(t)),V(t,!1)}async function A(t){return V(R(t.parent,T(m(),"==",t.id)),!0)}async function ct(t){return new h(null,null,[await t.ref.airstore.api("/count/"+encodeURIComponent(t.ref.path)+"?query="+encodeURIComponent(JSON.stringify(t.query)))],["count"])}function T(t,e,r){return{filter:{prop:t,op:e,val:r}}}function ut(t,e,...r){let n={order:[t],desc:[e]};for(let o=0;o<r.length;o++)n.order.push(r[o]),n.desc.push(r[o]);return n}function at(...t){return{cursor:t,op:">"}}function pt(t){return{limit:t}}function lt(...t){return{cursor:t,op:"<"}}function ft(t){return{limit:-t}}var v=class{airstore;constructor(e){this.airstore=e}spec={writes:[],reads:[]};set(e,r){this.spec.writes.push([e.parent.path,e.id,r,"create&update"])}update(e,r){this.spec.writes.push([e.parent.path,e.id,r,"update"])}create(e,r){this.spec.writes.push([e.parent.path,e.id,r,"create"])}async commit(){await this.airstore.api("/transaction","POST",this.spec)}},O=class extends v{constructor(e){super(e)}async get(e){let r=await A(e);return this.spec.reads.push([e.parent.path,e.id,r.exists()&&r.version()]),r}};async function dt(t,e){let r=0;for(;r<10;){let n=new O(t);await e(n);try{await n.commit();break}catch{}}}function ht(t){return new v(t)}var l=class{__isUpdateValue__=!0;constructor(e,r){this.type=e,this.val=r}};function m(){return"__id__"}function mt(){return new l("f-")}function _t(t){return new l("i+",t)}function xt(...t){return new l("a+",t)}function wt(...t){return new l("a-",t)}
