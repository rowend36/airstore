var O={__version__:!0,__id__:!0,rowid:!0};function D(t){return!/___/.test(t)&&/^[a-z][a-z_0-9]+(\/[a-z][a-z_0-9]+\/[a-z][a-z_0-9]+)*$/.test(t)}function v(t,e){return e!==!0&&console.log(t,v(t,!0)),O[t]||t.startsWith('"___')?t:/(?:^[^a-z_]|[^a-z0-9_])/.test(t)?JSON.stringify(t.startsWith("___")?t:"___"+t.replace(/\./g,"___")+"__"):t.startsWith("___")?t:"___"+t.replace(/\./g,"___")+"__"}function T(t,e){let r={};for(let n=0;n<e.length;n++){if(O[e[n]])return;let o=e[n];if(o.slice(0,3)==="___"){let s=o.slice(3,-2);if(s.indexOf("___")>-1){let c=s.split("___"),a=obj;for(let u=0;u<c.length-1;u++)a=a[c[u]]={};a[c[c.length-1]]=t[s]}else obj[s]=t[s]}else obj[o]=t[n]}return obj}var h,J=new Uint8Array(16);function y(){if(!h&&(h=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!h))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return h(J)}var i=[];for(let t=0;t<256;++t)i.push((t+256).toString(16).slice(1));function j(t,e=0){return i[t[e+0]]+i[t[e+1]]+i[t[e+2]]+i[t[e+3]]+"-"+i[t[e+4]]+i[t[e+5]]+"-"+i[t[e+6]]+i[t[e+7]]+"-"+i[t[e+8]]+i[t[e+9]]+"-"+i[t[e+10]]+i[t[e+11]]+i[t[e+12]]+i[t[e+13]]+i[t[e+14]]+i[t[e+15]]}var N=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),U={randomUUID:N};function V(t,e,r){if(U.randomUUID&&!e&&!t)return U.randomUUID();t=t||{};let n=t.random||(t.rng||y)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){r=r||0;for(let o=0;o<16;++o)e[r+o]=n[o];return e}return j(n)}var m=V;function Q(t,e){return{async api(r,n="GET",o=""){return await(await fetch(t+r,{body:n!=="GET"?JSON.stringify(o||{}):void 0,headers:{authorization:e.auth&&e.auth.currentUser?await e.auth.currentUser.getIdToken(!0).catch(function(s){console.error(s)}):null,"Content-Type":"application/json"},method:n})).json()}}}function R(t,e){return{path:t,id:t.split("/").pop(),airstore:e,_parent:null,get parent(){return this._parent||(this._parent=R(t.slice(0,-this.id.length-1),e))}}}function k(...t){let e=typeof t[0]=="object"?t.shift():null,r=t.join("/");if(r.split("/").length%2!==1)throw new Error("Wrong number of segments in collection");if(!D(r))throw new Error("Invalid path "+t);return R(r,e)}function A(...t){let e;if(typeof t[0]=="object")if(t[0].api)e=t.shift();else if(t[0].airstore)e=t[0].airstore,t[0]=t[0].path,t.length===1&&t.push(m().replace(/\-/g,""));else throw new Error("Invalid path: "+t);console.log(t);let r=t.join("/")??m().replace(/\-/g,"");if(r.split("/").length%2!==0)throw new Error("Wrong number of segments in doc");return R(r,e)}function W(t,e){return JSON.stringify(t)===JSON.stringify(e)}function q(t,e){return W(t,e)}async function g(t,e,r,n){try{return await t.airstore.api(e,r,n)}finally{let o=f[t.parent.path];o&&o.forEach(s=>s())}}async function tt(t){return await g(t,"/delete/"+encodeURIComponent(t.parent.path)+"/"+encodeURIComponent(t.id),"POST")}async function et(t,e,r){if(!r||!r.merge)throw new Error("merge must be true");return await g(t,"/set/"+encodeURIComponent(t.parent.path)+"/"+encodeURIComponent(t.id)+"?create&update","POST",e)}async function rt(t){return await g(A(t),"/set/"+encodeURIComponent(t.parent.path)+"/"+encodeURIComponent(t.id)+"?create","POST")}async function nt(t,e){return await g(t,"/set/"+encodeURIComponent(t.parent.path)+"/"+encodeURIComponent(t.id)+"?update","POST",e)}function S(t,...e){let r={};for(let n of e)if(n.order&&(r.order?(r.order.props.push(...n.order.props),r.order.desc.push(...n.order.desc)):r.order={props:[...n.order.props],desc:[...n.order.desc]}),n.limit!==void 0){if(r.limit!==void 0)throw new Error("Duplicate limit clause");r.limit=n.limit}for(let n of e)if(n.cursor)for(let o=0;o<n.cursor.length;o++)e.push({filter:{prop:typeof n.cursor[o]=="object"?w():r.order.props[o],op:n.op,val:n.cursor[o]}});for(let n of e)n.filter&&(r.filter&&!r.filter.next?r.filter.next=n.filter:!r.filter||!n.next?r.filter={...n.filter,next:r.filter}:r.filter={val:r.filter,next:n.filter});return{query:r,converter:void 0,withConverter(n){return{...this,converter:n}},ref:t}}var _=class{constructor(e,r,n,o){this.ref=e,this._conv=r,this._data=n,this.columns=o}data(e){if(!e&&this._conv)return this._conv.fromFirestore(this,{});if(this._data)return T(this._data,this.columns)}exists(){return!!this._data}get(e){return this._data[this.columns.indexOf(v(e))]}version(){return this._data?this.get("__version__"):!1}id(){return this.get(w())}},I=class{constructor(e){this._docs=null,this._data=e}get docs(){return this._docs||(this._docs=this._data.map(e=>e.data()))}},f={};function b(t,e,r,n){let o=r.rows.map(s=>typeof s=="string"?e._data.find(c=>c.id()):new _(t.ref,t.converter,s,r.columns));return n?o[0]||new _(t.ref):new I(o)}function ot(t,e){let r,n="path"in t;n&&(t=S(t.ref.parent,z(w(),"==",t.id)).withConverter(t.converter));let o="/poll/"+encodeURIComponent(t.ref.path)+"?query="+encodeURIComponent(JSON.stringify(t.query)),s,c,a=0,u=async function(){let l;if(a>0){console.log("waiting"),a=2;return}a=1,clearTimeout(c);try{let p=await t.ref.airstore.api(o+(r?"&cursor="+encodeURIComponent(r):""));if(p.cursor!==!0&&(r=p.cursor),p.rows&&(s=l=b(t,s,p,n)),l)return e.next(l)}catch(p){c!==null&&(e.error?e.error(p):console.error(p))}finally{a--,c!==null&&(c=setTimeout(()=>{a=0,u()},a===0?l?5e3:1e4:1e3),console.log(a===0?l?5e3:1e4:1e3))}};return f[t.ref.path]||(f[t.ref.path]=[]),f[t.ref.path].push(u),u(),()=>{clearTimeout(c),c=null;let l=f[t.ref.path].indexOf(u);l>-1&&f[t.ref.path].splice(l,1)}}async function E(t,e){return b(t,null,await t.ref.airstore.api("/collection/"+encodeURIComponent(t.ref.path)+"?query="+encodeURIComponent(JSON.stringify(t.query))),e)}async function it(t){return t.ref||(t=S(t)),E(t,!1)}async function B(t){return E(S(t.parent,z(w(),"==",t.id)),!0)}async function st(t){return b({},null,await t.ref.airstore.api("/count/"+encodeURIComponent(t.ref.path)+"?query="+encodeURIComponent(JSON.stringify(t.query))),!0)}function z(t,e,r){return{filter:{prop:t,op:e,val:r}}}function ct(t,e,...r){let n={props:[t],desc:[e]};for(let o=0;o<r.length;o++)n.order.push(r[o]),n.desc.push(r[o]);return{order:n}}function at(...t){return{cursor:t,op:">"}}function ut(t){return{limit:t}}function lt(...t){return{cursor:t,op:"<"}}function pt(t){return{limit:-t}}var x=class{airstore;constructor(e){this.airstore=e}spec={writes:[],reads:[]};set(e,r){this.spec.writes.push([e.parent.path,e.id,r,"create&update"])}update(e,r){this.spec.writes.push([e.parent.path,e.id,r,"update"])}create(e,r){this.spec.writes.push([e.parent.path,e.id,r,"create"])}delete(e){this.spec.writes.push([e.parent.path,e.id,null,"delete"])}async commit(){await this.airstore.api("/transaction","POST",this.spec)}},C=class extends x{constructor(e){super(e)}async get(e){let r=await B(e);return this.spec.reads.push([e.parent.path,e.id,r.exists()&&r.version()]),r}};async function ft(t,e){for(let r=0;r<10;r++){let n=new C(t);await e(n);try{await n.commit();break}catch(o){if(r===9)throw o;console.warn(o)}}}function dt(t){return new x(t)}var d=class{__isUpdateValue__=!0;constructor(e,r){this.type=e,this.val=r}};function w(){return"__id__"}function ht(){return new d("f-")}function mt(t){return new d("i+",t)}function _t(...t){return new d("a+",t)}function xt(...t){return new d("a-",t)}export{rt as addDoc,xt as arrayRemove,_t as arrayUnion,k as collection,tt as deleteDoc,ht as deleteField,A as doc,w as documentId,lt as endBefore,Q as getAirstore,st as getCountFromServer,B as getDoc,it as getDocs,mt as increment,ut as limit,pt as limitToLast,ot as onSnapshot,ct as orderBy,S as query,q as queryEqual,R as ref,W as refEqual,ft as runTransaction,et as setDoc,at as startAfter,nt as updateDoc,z as where,dt as writeBatch};
